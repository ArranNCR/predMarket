---
title: 'Put Your Money Where Your Mouth Is: Prediction Markets and Climate Change'
author: "John J. Nay, Martin Van der Linden, Jonathan Gilligan"
date: "March 12, 2016"
output:
  pdf_document:
    keep_tex: yes
  html_document: default
bibliography: library.bib
---
```{r fig_ref, echo=FALSE}
source("utils/fig_ref.R") # tabRef and figRef functions
source("utils/multi_plot.R")
``` 
```{r, caption_setting, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(knitr)
knit_hooks$set(htmlcap = function(before, options, envir) {
  if(!before) {
    paste('<p class="caption">',options$htmlcap,"</p>",sep="")
    }
    })
# small margins
knit_hooks$set(small_mar = function(before, options, envir) {
    if (before) par(mar = rep(0.0001, 4))  # smaller margins all around
})
# opts_chunk$set(dev="tiff", 
#                dev.args=list(compression="lzw", type="cairo"),
#                dpi=300)
```
```{r multi_plot, echo=FALSE}
source("utils/multi_plot.R")
library(ggplot2)
theme_set(theme_classic())
library(pander)
```

# Abstract

We present a simulation model as a computational test-bed for a climate prediction market. Traders adapt their beliefs about future global temperatures based on the monetary performance of their neighboring traders in a social network. We conduct experiments with the model to determine how a variety of market factors and the climate data-generating process may affect the extent to which climate prediction markets foster a convergence of market participants' beliefs regarding a true model of the global climate. We simulate two alternative climate futures: one where the natural log of CO$_2$ is the primary driver of global temperature and one where sun spots are the primary driver. These represent the two most plausible competing views in the public discourse. Market participation causes traders to converge toward believing the "true" climate model.

# 1. Introduction

The climate change debate has become strongly polarized over the past two decades. Although the scientific consensus on the anthropogenic nature of climate change strongly increased, beliefs about climate change did not evolve much within the public [@Vandenbergh2013f]. In addition, the divide on anthropogenic climate change between liberals and conservatives has grown steadily as the question is becoming increasingly politicized and potentially disconnected from scientific evidence. The costs of misinformed climate policies are high. If anthropogenic climate change is a myth but is taken to be true, public resources will be spent on unnecessary efforts. On the other hand, if climate change is human-induced but not recognized as so, the costs of inaction could be devastating. Given that effective climate policies require long-lasting measures to be taken, the importance of an accurate consensus on the issue is manifest.

Attempts to foster such consensus face many social and psychological challenges, some of which could be adressed by creating climate prediction markets where participants can "put their money where their mouths are" [@Hsu2011; @Vandenbergh2013f]. The idea of using prediction markets to efficiently aggregate information about uncertain events has been widely discussed [@Horn2014c]. Prediction markets have been shown to have interesting theoretical properties [@Set1998; @Hanson2012] and to perform well in terms of prediction accuracy and information aggregation in experiments [@Hanson2006; @Healy2010], simulation models [@Klingert2012c; @Jumadinova2011a], and the real-world [@Wolfers2006]. We simulate a prediction market where traders exchange securities related to climate outcomes to explore whether, and under what market and climate conditions, prediction markets may be useful for increasing convergence of climate beliefs. The ultimate goal is to initiate a computational design process for effective climate prediction markets.

# 2. Related Work

@Tseng2010a create an agent-based model (ABM) of a continuous double auction market with various types of market strategies, including two variants of the zero-intelligence agent. They compare the behavior of their simulation with data from a prediction market for the outcome of political elections. They find that despite their simplicity, zero-intelligence agents capture some salient features of real market data. @Klingert2012c reach similar conclusions with respect to experimental data from @Hanson2006. In their simulation, @Klingert2012c compare continuous double auctions with logarithmic market scoring rules and find that the latter generally outperform continuous double auctions in terms of prediction accuracy. In some variants of the two last models, agents' strategies feature learning, but these are rather basic and unrelated to a formal predictive model.

@Jumadinova2011a conducted research more similar to ours, as they explicitly include information about uncertain events in their model. @Jumadinova2011a study a continuous double auction model in which agents update their beliefs about the uncertain events based on information on the event. New beliefs are modeled as a weighted sum of the last period's beliefs and market prices. The agents' information set changes every period. The better the information set, the more likely the agent is to put higher weight on last period's prices when revising their beliefs. Little structure is imposed on the information set and the way it is used to generate the weights in the update function. Therefore, the model does not allow for investigating the convergence of predictive models. @Ontanon2009 study the effect of deliberation on a simulated prediction market. They assume that agents use Case-Based Reasoning [@Aamodt1994] to reason and debate about uncertain outcomes with their neighbors in a social network. Although the model could in theory be used to assess convergence of predictive models by looking at the arguments agents adopt after the deliberation, this is not done by the authors. Also, the way beliefs are formed and revised through argumentation is too abstract for studying climate prediction markets, where beliefs should be based on statistical time series models.

To the best of our knowledge, the idea that prediction markets can generate consensus *on the factors* affecting uncertain events has never been quantitatively explored. ABMs of prediction markets have been studied [@Klingert2012c; @Tseng2010a; @Jumadinova2011a], some of which feature communication between agents. In these models, however, beliefs about the uncertain outcomes are constructed in rather abstract ways. In particular, beliefs are not based on structural models from which agents could derive causal implications, and therefore these models are not suitable for investigating the convergence of the underlying explanatory models agents employ for prediction.

From a public policy perspective, changing the explanatory models of market participants is one of the most important roles that prediction markets might play. This is perhaps the most important social benefit of prediction markets given the comparable predictive power of statistical supervised learning models, which can provide information at a much lower cost than creating and maintaining a prediction market [@goel_prediction_2010]. Effective climate policy not only requires an accurate consensus on future climate *outcomes*. It also requires an accurate consensus on the causal *mechanisms* influencing such outcomes. If people agree that temperature will rise, but some believe it will be due to greenhouse gases, while others believe that it will be caused by increased solar activity, inconsistent and ineffective policies may be implemented.

# 2. Model Design

Traders bet on global temperature anomalies six years in the future. 
During the six-year period, traders buy and sell futures. 
Every year, traders update their models and forecast of future temperatures based on newly available data. 
At the end of each six-year period, winners collect gains and traders revise beliefs about climate models, based on their ideology and the beliefs of top earners in their social network. 
In this section, we describe the models used to generate future temperature data, agents beliefs about those models, the market procedures, and the social network connecting agents. 
We conclude with details on model dynamics and an overview of the model parameters.

## Temperature Models

We start with the historical temperature record and project future climates under two alternative theories: 

Temperature proportional to log(CO$_2$) or Total Solar Irradiance (conventional science vs. popular alternative among doubters). Add AR(1) noise (best ARMA noise model for historical record).

JG - describe the temperature time series models here. Add the plots of the time series diverging thats on middle of poster. Add citations for the models to library.bib.

## Climate Beliefs

Traders use one of the two models (temperature depends on CO$_2$ or TSI) to forecast future temperature. 
These models are interpreted as the trader's beliefs about the true climate process, the driving factor of long-term global temperatures. 
They represent pervasive positions on climate change in the public debate. In order to approximatively match the current configuration of beliefs in climate change in the United States, model 1 is randomly assigned to half of the traders, while 2 is assigned to the other half of the traders.

Thus, both when **true.model** = 0 and **true.model** = 1, approximately half of the traders use the true data-generating model to make predictions. 
Traders using the true model do not necessarily make perfectly accurate predictions however. 
Although these traders believe in the correct *functional form* of the model, they still need to calibrate their model based on limited noisy data. 
Therefore, the values these traders assign to the parameters of the model will typically be different from the exact parameters in the data-generating process.

## Traders and Market

Traders are initially endowed with a single experimental currency unit (ECU). 
Traders use their model to forecast the distribution of future temperature and determine their reservation price for different securities. 
Each security pays 1 ECU at the end of the trading sequence if the temperature at the end of the sequence falls into a certain range. 
Traders are risk-neutral expected utility maximizers. 
Therefore, their reservation price for a security is simply their assessment of the probability that the temperature will fall in the range covered by the security at the end of the sequence.
 		
Based on their reservation price, traders behave as "zero-intelligence" agents [@Gode1993].
They attempt to sell securities at a random price above their reservation, and to buy securities at a random price below their reservation.
These trading strategies are simple but provide accurate approximations of behavior in prediction markets [@Klingert2012c], and in financial markets more broadly.

Based on traders' sell and buy orders, traders exchange securities following a continuous-double auctions (CDA) procedure (see Model Dynamics below for more details). 
CDAs or some variants thereof are common procedures to match buy and sell orders. 
CDA are notably used on large stock markets [@Tseng2010a].
 
## Social Network

Traders are part of a social network where each agent forms two links at random, and then forms links randomly. 
This ensures that each agent is connected to at least two other agents. 
Every time securities are realized, each trader looks at the performance of her richest neighbor in the network. 
Traders start with the same initial amount of ECU and differences in ECU can only come from market interactions.
Therefore, if some trader is poorer that her richest neighbor, the trader interprets this has an signal that her richest neighbor may have a better model of the climate. 
Then, the trader considers adopting the model of her richest neighbor. 
For each trader, the willingness to revise her belief is determined by how ideologically loaded her belief is.

![Network](output/network.pdf)
 
An example of such social network is depicted in Figure X. 
We assume that the initial network is segregated.
Traders who initially believe in model 1 (resp. 2) are more likely to be linked with other traders who also believe in 1 (resp. 2). 
Although traders can change their approximate model over time, the connections between traders do not change as the market unfolds (i.e the edges are fixed).

## Model Dynamics

The time periods $t$ are grouped in trading *sequences*. 
In a given sequence, the potential payments associated with traded securities are all based on the temperature at the end of the sequence. 
For instance, the third trading sequence might start in period $t = 1964$ and end in period $t = 1970$. 
In this case, a security traded in the third sequence pays 1 ECU if the temperature at $t = 1970$ falls into the range of temperatures covered by the security. 


At each time $t$, traders are assumed to know the past value of the temperature ${T}_{0:t}$, carbon dioxide $CO2_{0:t}$, and total solar irradiance $TSI_{0:t}$. 
In a sequence finishing at time $t^*$,  traders also have common knowledge of $CO2_{t:t^*}$ and $TSI_{t:t^*}$, the future values of carbon dioxide and total solar irradiance up to $t^*$.
However, at any $t$, traders do not know the value of any future temperatures. 
In particular, in a given sequence, traders do not know the value of ${T}_{t^*}$. 
Traders can only predict ${T}_{t^*}$ using their approximate model and their knowledge of ${T}_{0:t}$, $CO2_{0:t^*}$, and $TSI_{0:t^*}$.
Notice that because ${T}_{0:t}$, $CO2_{0:t^*}$, and $TSI_{0:t^*}$ are common knowledge, in each period $t$, any two trader with the same approximate model $m$ forms the same stochastic beliefs about future temperatures $F_{tm}({T}_{t^*} ~|~ {T}_{0:t}, CO2_{0:t^*}, TSI_{0:t^*})$.   
 	   
 At each time $t$, traders :

1. recalibrate their approximate model based on the new set of temperature data available at $t$,
2. compute their stochastic beliefs about future temperatures $F_{tm}({T}_{t^*} ~|~ {T}_{0:t}, CO2_{0:t^*}, TSI_{0:t^*})$ and use it to determine the expected value they attached to each security, and
3. trade on the CDA market based on their zero-intelligence decision rule as follows: 
 	+ Every trader $i$ choses at random a security $s_i^B$ she will try to buy.
 	+ Every trader $i$ also chooses at random a security $s_i^S$ she will try to sell among the securities she owns a positive amount of (if any).
	+ Traders then decide of their selling price $p_i^S$ and buying price $p_i^B$. 
  To do so, traders first compute their expected values $E(s_i^B)$ and $E(s_i^S)$ for securities $s_i^B$ and $s_i^S$. 
  Then traders set $p_i^S$ at random above $E(s_i^S)$ and $p_i^B$ at random below $E(s_i^B)$ (see Model Parameters below for more details). 
  
	+ Traders go to the market one at the time, in an order drawn randomly for each $t$.
 	+ When trader $i$ comes to the market, she places limit orders in the order book. 
   These orders specify that $i$ is willing to buy $s_i^B$ at any price below $p_i^B$, and to sell $s_i^S$ at any price above $p_i^S$.
 	+ The market maker then tries to match $i$'s orders with some order which was put in the book before $i$ came to the market.
 	+ If there are  outstanding sell offers for $s_i^B$ at a price below $p_i^B$, a trade is concluded. 
   Trader $i$ buys one unit of $s_i^B$ from the sellers who sells at the highest price below $p_i^B$, and the sell and buy offers are removed from the order book.
 	+ If there are outstanding buy offers for $s_i^S$ at price above $p_i^S$, a trade is concluded. 
   Trader $i$ sells one unit to the buyer who buys at the highest price above $p_i^S$, and the sell and buy offers are removed from the order book.
 	+ Whenever all traders have come to the market, any remaining outstanding offer is removed from the order book, and the trading period is concluded. 
 	
At $t^*$, when the sequence ends, there is only one security $s^*$ associated with a range of temperatures including the actual temperature $T_{t^*}$. 
At $t^*$, traders:

1.  receive 1 ECU per unit of $s^*$ they own, and
2.  consider adapting their neighbors' approximate model as described above.
 	
## Model Parameters
 	
The model depends on the following parameters, which we vary in simulation experiments to determine their effects on the convergence of beliefs. 

* Network parameters:
    + **n.traders**: the number of traders.
    + **n.edg**: the number of edges in the social network.
    + **seg**: the initial degree of homophily in the network. The higher **seg**, the higher the initial homophily. 
    
* Behavioral parameters.
    + **risk.tak** : determines the distribution of risk-taking behavior. 
    For each trader $i$, the level of \texttt{risk.tak}$_i$ is drawn uniformly at random from $[0,$\texttt{risk.tak} $]$.
    The higher \texttt{risk.tak}$_i$, the higher (resp. lower) the price $i$ will set for the securities $i$ tries to sell (resp. buy).
    Formally, let $\texttt{reserv}_{it}$ be the reservation price of trader $i$ at time $t$ for some security $s$.
    Then trader $i$ picks her buying (resp. selling) price for $s$ uniformly at random in the interval  $[\texttt{reserv}_{it}, \allowbreak \texttt{reserv}_{it}  * (1 - \texttt{risk.tak}_i)]$ (resp. $[\texttt{reserv}_{it}, \allowbreak \texttt{reserv}_{it} * (1  + \texttt{risk.tak}_i)]$). 
    
    + **ideo** :  determines the degree of "ideology" of traders.
    For each trader $i$, the level of \texttt{ideo}$_i$ is drawn uniformly at random from $[0,$\texttt{ideo} $]$.
    If ideo is high, traders will not revise their approximate models easily, even when faced with evidence that their richest neighbor is doing better than them. 
    Formally, for each trader $i$ and each sequence, a parameter $d_{i}$ is drawn from $[0, \texttt{ideo}_i]$. 
    The value of $d_{i}$ is the probability that $i$ adopts one of her neighbors' approximate model if this neighbor is doing better than $i$ at the end of the sequence (in monetary terms).

# 3. Results

## Historical Data

As a validation that the market is operating correctly, we run the market with actual temperatures 1880 to 2015 and market betting from 1931 to 2014. As warming signal begins to show up in 1980s, traders begin to converge toward the log(CO$_2$) model (`r figRef("time")`).

## Future Scenarios

The sensitivity analysis is based on a Latin Hypercube Sampling of parameter sets from the following distributions [@beachkofski_improved_2002; @carnell_lhs_2012]. 

* ideo $\sim Unif(0,1)$
* market.complet $\sim Unif(0,1000)$ (mapped into integer)
* n.edge $\sim Unif(100,200)$ (mapped into integer)
* n.traders $\sim Unif(50,250)$ (mapped into integer)
* risk.tak  $\sim Unif(0,1)$
* seg $\sim Unif(0,1)$
* true.model $\sim Binom(0.5)$

We use the model to simulate 10,000 outcomes based on the input paramter sets and then conduct a partial rank correlation coefficient analysis on the relationship between the input matrix, $X$, resulting simulated vector, $y$ [@Marino2008; @pujol_sensitivity:_2014; @saltelli_sensitivity_2009]. Partial correlation computes the linear relationship between the part of the variation of $X_i$ and $y$ that are linearly independent of other $X_j$  ($j \neq i$).  The only difference with the partial correlation and partial rank correlation (which we use here), is that the outcome variable $y$ is first ranked-transformed in order to allow us capture potentially non-linear relationships. That is every value, $y_s$, in the data set is replace by a number $f(y_s) \equiv |\{y_r~|~ y_s > y_r\}|$, where $y_r$ are the other observed values of $y$ in the data set.

Our sensitivity analysis, `r figRef("sa")`, shows that ideology, risk tolerance, the number of traders, the number of edges per trader, the segmentation of the social network, and the true model all significantly affect convergence. Segmented social networks can create an "echo-chamber" effect. Market participation causes traders to converge toward believing the "true" climate model; however, when the true model is CO$_2$-driven there is more convergence due to less noise in the relationship between predictor variable (log of CO$_2$ versus TSI) and temperature.

```{r sa, eval=TRUE, echo=FALSE, message=FALSE, htmlcap=figRef("sa", "Estimated effects of model parameters on convergence of beliefs in future scenario."), fig.width=3, fig.height=3.5}
# library(eat)
# load("output/src_future.Rda")
# plot(src_future, outcome_var = "Convergence") + theme_classic() + theme(text=element_text(family='Palatino'))

source("utils/sa_plot.R")
sa_plot() + theme(text=element_text(family='Palatino'))
#multi_plot(p1, p2, cols = 2)
```

The sensitivity analysis averages over time (and model replicates) and thus masks time trends. We randomly drew from the above distributions for ideology, risk tolerance, and the number of traders, and set conducted an experiment crossing 95% and 5% percentile values for the number of edges per trader and the segmentation of the social network and both values for the true model. We then collected the time series of convergence across these eight designs (`r figRef("time")`).

```{r time, eval=FALSE, echo=FALSE, message=FALSE, htmlcap=figRef("time", "Convergence over trading sequences."), fig.width=10.5, fig.height=8.5}
source("utils/time_plot.R")
p1 <- history_box() + theme(text=element_text(family='Palatino'))
p2 <- future_box() + theme(text=element_text(family='Palatino'))
multi_plot(p1, p2, cols=2)
```

```{r sa2, eval=TRUE, echo=FALSE, message=FALSE, htmlcap=tabRef("sa2", "")}

```

 `r tabRef("one")` 


# 4. Discussion

Our code for the model is available at [johnjnay.com/predictMarket](http://johnjnay.com/predictMarket). This project is a computational test-bed for public policy design.

Existing prediction markets (e.g. hypermind.com, betfair.com, and predictit.org) focus on nearer term events (months in advance), but have been shown to have performance superior to statistical models for some event types [@pathak_comparison_2015].

# Acknowledgements

We would like to thank Yevgeniy Vorobeychik for feedback on this project.

# References

```{r, finalize, eval=TRUE, echo=FALSE}
# Print out warnings if we did not use all the figures.
if(!all(environment(figRef)$created)){
    missingFig <- which(!environment(figRef)$created)
    warning("Figure(s) ", paste(missingFig, sep=", "), " with label(s) '", 
      paste(names(environment(figRef)$created)[missingFig], sep="', '"),
      "' are referenced in the text but have never been created.")
}
if(!all(environment(figRef)$used)){
    missingRef <- which(!environment(figRef)$used)
    warning("Figure(s) ", paste(missingRef, sep=", "), " with label(s) '", 
      paste(names(environment(figRef)$used)[missingRef], sep="', '"),
      "' are present in the document but are never referred to in the text.")
}
```
